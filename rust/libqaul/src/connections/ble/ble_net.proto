// qaul network communication over BLE
syntax = "proto3";
package qaul.net.ble;

// BLE network communication message
message BleMessage {
    // message type
    oneof message {
        // info message
        bytes info = 1;
        // feed message
        bytes feed = 2;
        // messaging message
        bytes messaging = 3;
        // identification request
        Identification identification = 4;
        // encrypted transport message
        EncryptedBleTransport encrypted = 5;
        // noise handshake message
        NoiseHandshake handshake = 6;
    }
}

// Identfication Request
message Identification {
    bool request = 1;
    NodeIdentification node = 2;
}

// Identity Information
message NodeIdentification {
    // Node ID
    bytes id = 1;
}

// Encrypted transport wrapper for BLE messages
message EncryptedBleTransport {
    // Session identifier
    uint32 session_id = 1;
    // Message nonce (counter)
    uint64 nonce = 2;
    // Encrypted ciphertext
    bytes ciphertext = 3;
}

// Noise protocol handshake message
message NoiseHandshake {
    // Session identifier
    uint32 session_id = 1;
    // Handshake message number (1 or 2)
    uint32 message_number = 2;
    // Handshake payload
    bytes payload = 3;
}
